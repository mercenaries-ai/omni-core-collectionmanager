<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collection Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="./style.scss" rel="stylesheet">
    <style>
      [x-cloak] {
        display: none !important;
      }

    </style>
    <script src="./main" type="module" defer></script>
  </head>

  <body class="p-6 select-none overflow-hidden bg-white"
  >
    <div class="m-h-screen bg-white" x-data="appState"  @keydown.window.prevent.stop.ctrl.shift.f="window.parent.client.workbench.activeExtension ? window.parent.client.workbench.hideExtension() :  window.parent.client.workbench.showExtension('omni-core-filemanager', {})">
      <div id="container" class="bg-white" x-data="createGallery(50 , '')" @keydown.escape.window="viewerMode ? window.parent.client.workbench.hideExtension() : multiSelectedItems.length>0 ? multiSelectedItems = [] :  focusedItem ? focusedItem = null :  window.parent.client.workbench.hideExtension()">
        <!-- Gallery Nav  -->
        <div x-show="!viewerMode && !focusedItem" class="fixed top-0 left-0 w-full h-full flex flex-col items-center justify-center  overflow-hidden" >
          <div x-data="{hoverItem: null}" class=" relative p-2 flex flex-row items-top justify-center" style="width: 98vw; height: 98.9vh; overflow: hidden" >
            <div class="absolute p-2 flex justify-between items-center gap-2 h-12 text-black drop-shadow-md shadow-black w-full">
              <!--h3 x-text="getTitle()">Title</h3-->
              <span @click="await fetchItems({limit: itemsPerPage,replace:true}); multiSelectedItems=[]; window.scrollTo({ top: 0, behavior: 'smooth' }); "  class="flex text-black items-center justify-center w-auto h-8 px-3 py-1 text-xs bg-red-500/60  border-0 rounded-md cursor-pointer  hover:bg-gray-500 active:bg-gray-600 focus:bg-gray-600 focus:outline-none  hover:text-neutral-600 group">
                <span></span>
                <svg class="w-5 h-5 " xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="black" class="w-6 h-6"> >
                  <polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                </svg>
              </span>
              <span x-cloak @click="await deleteByFid(multiSelectedItems)" x-show="multiSelectedItems.length > 0" class="flex text-black items-center justify-center w-auto h-8 px-3 py-1 text-xs bg-red-500/60   rounded-md cursor-pointer  hover:bg-gray-500 active:bg-gray-600 focus:bg-gray-600 focus:outline-none  hover:text-neutral-600 group">
                <span>Delete</span>
                <svg class="w-5 h-5 ml-0.5" xmlns="http://www.w3.org/2000/svg" fill="red" viewBox="0 0 24 24" stroke-width="2" stroke="black" class="w-6 h-6"> >
                  <polyline points="3 6 5 6 21 6" />
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0  1 2-2h4a2 2 0 0 1 2 2v2" />
                  <line x1="10" y1="11" x2="10" y2="17" />
                  <line x1="14" y1="11" x2="14" y2="17" />
                </svg>
              </span>
              <div class="flex-grow"></div>

              <div class="searchWrapper text-sm pr-10">
                <input
                  autocomplete="off"
                  x-ref="search"
                  class="search__field"
                  x-model.debounce.500ms="search"
                  id="search"
                  type="search"
                  placeholder="Search for..."
                />
                <div class="search__icon">
                  <label class="sr-only" for="search"> Search </label>
                  <svg width="25px" height="25px" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M24 24L18.3221 18.3221M21.2941 11.1471C21.2941 5.54299 16.7511 1 11.1471 1C5.54299 1 1 5.54299 1 11.1471C1 16.7511 5.54299 21.2941 11.1471 21.2941C16.7511 21.2941 21.2941 16.7511 21.2941 11.1471Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div class="flex-grow"></div>

              </div>
            </div>
            <!-- Gallery -->
            <div class="relative custom-scroll w-full h-full mt-14" >
              <template x-if="type ==='block'">
                  {{>main_list}}
              </template>
              <template x-if="type !=='block'">
                {{>main_grid}}
            </template>

            </div>
            <div class="absolute bottom-0 left-0 right-0 p-2 gap-5 z-10 font-semibold drop-shadow shadow-white bg-white bg-opacity-50 text-sm flex justify-between items-center h-8">
              <span class="font-semibold"></span>
              <span x-text="items.length+' items.'"></span>
              <span x-text="multiSelectedItems.length+' selected'"></span>
              <span class="flex-grow"></span>

              <span class="pr-4" x-text="hoverItem?.ticket?.fid"></span>
            </div>
          </div>
        </div>
        <!-- Item Viewer -->
        <div x-cloak x-show="viewerMode || focusedItem" class="fixed  top-0 left-0 w-full h-full flex items-center justify-center bg-gray-300 opacity-100 z-10" @click="viewerMode ? window.parent.client.workbench.activeScreen ='editor' : focusedItem = null" @keydown.window.escape="viewerMode ? window.parent.client.workbench.activeScreen ='editor' : focusedItem = null" @keydown.window.arrow-right="nextItem()" @keydown.window.arrow-left="previousItem()">
          <div class="relative flex items-center justify-center bg-black bg-opacity-40" style="width: 98vw; height: 98vh; overflow: hidden;" @click.stop @contextmenu.prevent @mouseenter="showInfo = true" @mouseleave="showInfo = false">
            <img x-show="focusedItem" :src="renderItem(focusedItem)" :style="{ transform: `scale(${scale}) translate(${x}px, ${y}px)`}" class="object-contain transition-opacity duration-200" :class="{ 'opacity-0': loading }" @wheel.prevent="zoomItem" @mousedown="startMoving" @mousemove="move" @mouseup="stopMoving" @mouseleave="stopMoving" x-ref="zoomImg" />
            <div @click.stop="previousItem()" x-show="!viewerMode" class="w-10 h-full absolute top-0 left-0 flex items-center justify-center  text-white text-4xl cursor-pointer">‹</div>
            <div x-show="showInfo" class="absolute text-lg top-0 left-0 right-0 p-2  flex justify-between items-center gap-5 bg-black bg-opacity-50 h-12 text-white drop-shadow-md shadow-black">

              <span x-show="!focusedItem?.onclick" @click="sendToChat(focusedItem)" class="flex items-center justify-center w-auto h-8 px-3 py-1 text-xs bg-transparent border rounded-md cursor-pointer border-neutral-200/60 hover:bg-gray-500 active:bg-gray-600 focus:bg-gray-600 focus:outline-none text-neutral-500 hover:text-neutral-600 group">
                <span>Send To Chat</span>
                <svg class="w-5 h-5 ml-1.5 stroke-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                  <line x1="22" y1="2" x2="11" y2="13" />
                  <polygon points="22 2 15 22 11 13 2 9 22 2" />
                </svg>
              </span>
              <a x-show="!focusedItem?.onclick" :href="focusedItem?.url+'?download=true'" class="flex items-center justify-center w-auto h-8 px-3 py-1 text-xs bg-transparent border rounded-md cursor-pointer border-neutral-200/60 hover:bg-gray-500 active:bg-gray-600 focus:bg-gray-600 focus:outline-none text-neutral-500 hover:text-neutral-600 group">
                <span>Download</span>
                <svg class="w-5 h-5 ml-1.5 stroke-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                  <polyline points="7 10 12 15 17 10" />
                  <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
              </a>





              <div x-data="copyToClipboardComponent()" class="">
                <button x-show="!focusedItem?.onclick" @click="copyToClipboard(focusedItem);" class="flex items-center justify-center w-auto h-8 px-3 py-1 text-xs bg-transparent border rounded-md cursor-pointer border-neutral-200/60 hover:bg-gray-500 active:bg-gray-600 focus:bg-gray-600 focus:outline-none text-neutral-500 hover:text-neutral-600 group">
                  <span x-show="!copyNotification">Copy to Clipboard</span>
                  <svg x-show="!copyNotification" class="w-5 h-5 ml-1.5 stroke-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                  </svg>
                  <span x-show="copyNotification" class="tracking-tight text-green-500" x-cloak>Copied to Clipboard</span>
                  <svg x-show="copyNotification" class="w-5 h-5 ml-1.5 text-green-500 stroke-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0118 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3l1.5 1.5 3-3.75" />
                  </svg>
                </button>
              </div>
              <span x-show="!focusedItem?.onclick" @click="await deleteByFid(focusedItem.ticket.fid)" class="flex items-center justify-center w-auto h-8 px-3 py-1 text-xs bg-transparent border rounded-md cursor-pointer border-neutral-200/60 hover:bg-gray-500 active:bg-gray-600 focus:bg-gray-600 focus:outline-none text-neutral-500 hover:text-neutral-600 group">
                <span>Delete</span>
                <svg class="w-5 h-5 ml-1.5 stroke-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                  <polyline points="3 6 5 6 21 6" />
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                  <line x1="10" y1="11" x2="10" y2="17" />
                  <line x1="14" y1="11" x2="14" y2="17" />
                </svg>
              </span>
              <span class="flex-grow"></span>
              <span @click.stop="x=0;y=0;scale=1" class="flex items-center justify-center w-auto h-8 px-3 py-1 text-xs bg-transparent border rounded-md cursor-pointer border-neutral-200/60 hover:bg-gray-500 active:bg-gray-600 focus:bg-gray-600 focus:outline-none text-neutral-500 hover:text-neutral-600 group">
                <span>Fit Screen</span>
                <svg class="w-5 h-5 ml-1.5 stroke-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                  <path xmlns="http://www.w3.org/2000/svg" d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" />
                </svg>
              </span>
              <span @click.stop="viewerMode ? window.parent.client.workbench.activeScreen ='editor' : focusedItem = null" class="flex items-center justify-center w-auto h-8 px-3 py-1 mr-8 text-xs bg-transparent border rounded-md cursor-pointer border-neutral-200/60 hover:bg-gray-500 active:bg-gray-600 focus:bg-gray-600 focus:outline-none text-neutral-500 hover:text-neutral-600 group">
                <span>Close</span>
                <svg class="w-5 h-5 ml-1.5 stroke-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                  <line x1="18" y1="6" x2="6" y2="18" />
                  <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
              </span>
              </button>
            </div>
            <div x-show="showInfo" class="absolute bottom-0 left-0 right-0 p-2 gap-5 z-10 font-semibold drop-shadow shadow-white bg-white bg-opacity-50 text-sm flex justify-between items-center h-8">
              <span><span class="font-semibold"></span> <span x-text="focusedItem ? new Date(focusedItem.meta.created).toLocaleString(): ''"></span></span>
              <span><span class="font-semibold"></span> <span x-text="focusedItem?.mimeType?.startsWith('item/') ? focusedItem?.meta.width + 'x' + focusedItem?.meta.height + ' pixels' : ''"></span></span>
              <span><span class="font-semibold"></span><span class="drop-shadow-md" x-text="focusedItem?.mimeType + ' ' + focusedItem?.meta?.type"></span></span>
              <span><span class="font-semibold"></span><span class="drop-shadow-md" x-text="focusedItem?.fileName"></span></span>

            </div>
            <div @click.stop="nextItem()" x-show="!viewerMode" class="w-10  h-full absolute top-0 right-0  flex items-center justify-center text-white text-4xl cursor-pointer">›</div>
          </div>
        </div>

      </div>
    </div>
  </body>

</html>